--TASK 3 GroupBy, Aggregate Functions, Having, Order By, where 

--14. Find the total number of couriers handled by each employee

SELECT EmployeeID, COUNT(CourierID) AS TotalCouriersHandled
FROM Courier
GROUP BY EmployeeID
  

--15. Calculate the total revenue generated by each location
SELECT L.LocationID, L.LocationName, SUM(P.Amount) AS TotalRevenue
FROM Payment P
JOIN Location L ON P.LocationID = L.LocationID
GROUP BY L.LocationID, L.LocationName


--16. Find the total number of couriers delivered to each location
SELECT L.LocationID, L.LocationName, COUNT(C.CourierID) AS TotalDeliveredCouriers
FROM Payment P
JOIN Courier C ON P.CourierID = C.CourierID
JOIN Location L ON P.LocationID = L.LocationID
WHERE C.Status = 'Delivered'
GROUP BY L.LocationID, L.LocationName


--17. Find the courier with the highest average delivery time
SELECT C.TrackingNumber, 
       AVG(DATEDIFF(DAY, P.PaymentDate, C.DeliveryDate)) AS AvgDeliveryTime
FROM Courier C
JOIN Payment P ON C.CourierID = P.CourierID
GROUP BY C.TrackingNumber
HAVING AVG(DATEDIFF(DAY, P.PaymentDate, C.DeliveryDate)) = 
       (SELECT MAX(AvgDelivery) 
        FROM (SELECT AVG(DATEDIFF(DAY, P.PaymentDate, C.DeliveryDate)) AS AvgDelivery
              FROM Courier C
              JOIN Payment P ON C.CourierID = P.CourierID
              GROUP BY C.TrackingNumber) AS SubQuery);

--18. Find locations with total payments less than a certain amount
SELECT L.LocationID, L.LocationName, SUM(P.Amount) AS TotalPayments
FROM Payment P
JOIN Location L ON P.LocationID = L.LocationID
GROUP BY L.LocationID, L.LocationName
HAVING SUM(P.Amount) < 300

--19. Calculate total payments per location
SELECT L.LocationID, L.LocationName, SUM(P.Amount) AS TotalPayments
FROM Payment P
JOIN Location L ON P.LocationID = L.LocationID
GROUP BY L.LocationID, L.LocationName
 
--20.Query to Retrieve Couriers with Payments > 100 in a Specific Location (LocationID = X)
select CourierID, SUM(Amount) AS TotalPayment
from Payment
where LocationID = 304
group by CourierID
having sum(Amount) > 100


--21. Retrieve couriers who have received payments totaling more than 100 after a certain date 
--(PaymentDate) > 'YYYY-MM-DD'):

select CourierID, sum(Amount) as TotalPayment
from Payment
where PaymentDate > '2025-03-15'
group by CourierID
having sum(Amount) > 150

Select * from Payment

--22. Retrieve locations where the total amount received is more than 200 before a certain date 
--(PaymentDate > 'YYYY-MM-DD')
select LocationID, sum(Amount) as TotalAmountReceived
from Payment
where PaymentDate < '2025-03-18'
group by LocationID
having sum(Amount) > 200
